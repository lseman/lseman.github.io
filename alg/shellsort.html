<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shell Sort — Interactive Visualizer (Vanilla JS + Tailwind)</title>
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen w-full bg-gradient-to-br from-indigo-50 via-sky-50 to-emerald-50 text-slate-800">
  <div class="mx-auto max-w-6xl px-5 py-8">
    <header>
      <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight text-slate-900">Shell Sort — Interactive Visualizer</h1>
      <p class="mt-2 text-slate-600 max-w-3xl">
        Shell Sort generalizes insertion sort by first sorting elements far apart using a <b>gap</b> sequence, then decreasing the gap until it becomes 1.
        Each gap performs a <em>gapped insertion sort</em>, dramatically reducing the total number of shifts for many inputs.
      </p>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-3 gap-6 pb-16 mt-6">
      <!-- Left: Visualization -->
      <section class="lg:col-span-2 flex flex-col gap-4">
        <div class="rounded-3xl border border-slate-200 bg-white p-4 shadow-sm">
          <div class="flex flex-wrap items-center gap-2 mb-3">
            <button id="btnPlay" class="px-3 py-2 rounded-xl shadow-sm border bg-white hover:bg-slate-50 text-sm font-medium">Play</button>
            <button id="btnStep" class="px-3 py-2 rounded-xl shadow-sm border bg-white hover:bg-slate-50 text-sm">Step</button>
            <button id="btnReset" class="px-3 py-2 rounded-xl shadow-sm border bg-white hover:bg-slate-50 text-sm">Reset</button>
            <button id="btnShuffle" class="px-3 py-2 rounded-xl shadow-sm border bg-white hover:bg-slate-50 text-sm">Shuffle</button>

            <div class="ml-auto flex items-center gap-3">
              <label class="text-sm text-slate-600">Speed</label>
              <input id="rangeSpeed" type="range" min="50" max="1500" value="400" class="w-40">
              <label class="text-sm text-slate-600">Size</label>
              <input id="rangeSize" type="range" min="6" max="96" value="32" class="w-40">
            </div>
          </div>

          <div class="flex flex-wrap items-center gap-3 mb-3">
            <label class="text-sm text-slate-600">Gap sequence</label>
            <select id="gapMode" class="px-3 py-2 rounded-xl border bg-white shadow-sm text-sm">
              <option value="ciura" selected>Ciura (extended)</option>
              <option value="knuth">Knuth (3k+1)</option>
              <option value="powers">Powers of two</option>
            </select>
            <div class="text-sm text-slate-600">Current gap: <span id="curGap" class="font-semibold">—</span></div>
          </div>

          <div id="bars" class="relative w-full h-64 md:h-72 lg:h-80 flex items-end gap-1 p-2 rounded-2xl bg-gradient-to-b from-white to-slate-100 border border-slate-200"></div>

          <div class="mt-4 grid grid-cols-3 gap-3">
            <div class="flex flex-col items-center justify-center rounded-2xl bg-white/60 backdrop-blur p-3 shadow-sm">
              <div class="text-xs uppercase tracking-wide text-slate-500">Comparisons</div>
              <div id="statComparisons" class="text-xl font-semibold tabular-nums text-slate-900">0</div>
            </div>
            <div class="flex flex-col items-center justify-center rounded-2xl bg-white/60 backdrop-blur p-3 shadow-sm">
              <div class="text-xs uppercase tracking-wide text-slate-500">Shifts</div>
              <div id="statMoves" class="text-xl font-semibold tabular-nums text-slate-900">0</div>
            </div>
            <div class="flex flex-col items-center justify-center rounded-2xl bg-white/60 backdrop-blur p-3 shadow-sm">
              <div class="text-xs uppercase tracking-wide text-slate-500">Array Size</div>
              <div id="statSize" class="text-xl font-semibold tabular-nums text-slate-900">32</div>
            </div>
          </div>
        </div>

        <div class="rounded-3xl border border-slate-200 bg-white p-4 shadow-sm">
          <h3 class="text-lg font-semibold mb-2">Pseudocode</h3>
          <pre id="pseudocode" class="rounded-2xl p-4 bg-slate-900 text-slate-100 text-sm leading-6 overflow-auto"><code>
<span data-line="1" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">01</span>GAPS ← decreasing gap sequence (e.g., Ciura)</span>
<span data-line="2" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">02</span>for g in GAPS:</span>
<span data-line="3" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">03</span>  for i = g .. n-1:</span>
<span data-line="4" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">04</span>    key ← A[i]; j ← i - g</span>
<span data-line="5" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">05</span>    while j ≥ 0 and A[j] &gt; key:</span>
<span data-line="6" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">06</span>      A[j+g] ← A[j]   // shift by gap</span>
<span data-line="7" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">07</span>      j ← j - g</span>
<span data-line="8" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">08</span>    A[j+g] ← key      // insert</span>
          </code></pre>
        </div>
      </section>

      <!-- Right: Theory & Complexity -->
      <aside class="flex flex-col gap-4">
        <div class="rounded-3xl border border-slate-200 bg-white p-5 shadow-sm">
          <h3 class="text-lg font-semibold">How Shell Sort Works</h3>
          <p class="mt-2 text-sm leading-6 text-slate-600">
            For each <span class="font-mono">gap = g</span>, the array is partitioned into <span class="font-mono">g</span> interleaved subsequences.
            A gapped insertion sort is performed on each, moving elements towards their final positions.
            As g decreases, the array becomes increasingly ordered; the final <span class="font-mono">g=1</span> pass is a nearly-sorted insertion sort.
          </p>
          <ul class="mt-3 text-sm text-slate-700 list-disc pl-5 space-y-1">
            <li><span class="font-medium text-cyan-700">Cyan</span>: current key,</li>
            <li><span class="font-medium text-amber-700">Amber</span>: current j being compared,</li>
            <li><span class="font-medium text-rose-700">Rose</span>: shifted element by <span class="font-mono">g</span>,</li>
            <li><span class="font-medium text-emerald-700">Emerald</span>: items already fixed for this <span class="font-mono">g</span> pass.</li>
          </ul>
        </div>

        <div class="rounded-3xl border border-slate-200 bg-white p-5 shadow-sm">
          <h3 class="text-lg font-semibold">Gap Sequences</h3>
          <p class="text-sm text-slate-600">Different sequences change performance:</p>
          <ul class="mt-2 text-sm text-slate-700 list-disc pl-5 space-y-1">
            <li><b>Ciura</b> (empirical): 1, 4, 10, 23, 57, 132, 301, 701, ... (extended ×2.25)</li>
            <li><b>Knuth</b>: 1, 4, 13, 40, 121, ... (h = 3h+1)</li>
            <li><b>Powers of two</b>: ..., 8, 4, 2, 1</li>
          </ul>
          <p class="mt-2 text-xs text-slate-500">Exact runtime bounds depend on the sequence. Ciura is strong in practice; theory varies.</p>
        </div>

        <div class="rounded-3xl border border-slate-200 bg-white p-5 shadow-sm">
          <h3 class="text-lg font-semibold">Complexity</h3>
          <div class="mt-2 grid grid-cols-2 gap-3 text-sm">
            <div class="rounded-xl bg-slate-50 p-3 border border-slate-200">
              <div class="text-slate-500 text-xs uppercase">Time</div>
              <p class="mt-1">Between <span class="font-mono">O(n)</span> and <span class="font-mono">O(n²)</span> depending on gaps; best practical choices give ~
                <span class="font-mono">O(n^{1.2..1.5})</span>.</p>
            </div>
            <div class="rounded-xl bg-slate-50 p-3 border border-slate-200">
              <div class="text-slate-500 text-xs uppercase">Space</div>
              <p class="mt-1">O(1) extra memory (in-place), stable only with care.</p>
            </div>
          </div>
        </div>
      </aside>
    </main>

    <footer class="text-center text-xs text-slate-500 pb-4">Built for learning. Use sliders to explore behavior. Toggle gap sequences to compare.</footer>
  </div>

  <script>
    // -------- Utilities --------
    function rngArray(n, min = 5, max = 100) {
      return Array.from({ length: n }, () => Math.floor(min + Math.random() * (max - min + 1)));
    }

    function gapsCiura(n){
      const base = [1,4,10,23,57,132,301,701,1750];
      const gaps = base.slice();
      while (gaps[gaps.length-1] < n){
        gaps.push(Math.floor(gaps[gaps.length-1] * 2.25));
      }
      return gaps.filter(g=>g<n).reverse();
    }

    function gapsKnuth(n){
      const gaps = [];
      let h = 1;
      while (h < n){ gaps.push(h); h = 3*h + 1; }
      return gaps.reverse();
    }

    function gapsPowers(n){
      const gaps = [];
      let h = 1;
      while (h < n) h <<= 1;
      while (h > 0){ gaps.push(h); h >>= 1; }
      return gaps.filter(g=>g<n && g>0);
    }

    function getGaps(n, mode){
      if (mode === 'knuth') return gapsKnuth(n);
      if (mode === 'powers') return gapsPowers(n);
      return gapsCiura(n); // default ciura
    }

    // Generator that yields visualization steps for Shell sort
    function* shellSortSteps(original, gaps){
      const a = [...original];
      const n = a.length;
      for (const g of gaps){
        // announce gap change
        yield { type: 'gap', g, snapshot: [...a], line: 2 };
        for (let i = g; i < n; i++){
          const key = a[i];
          let j = i - g;
          // key + init
          yield { type: 'outer', g, i, key, j, snapshot: [...a], line: 3 };
          yield { type: 'prep',  g, i, key, j, snapshot: [...a], line: 4 };

          while (j >= 0 && a[j] > key){
            yield { type: 'compare', g, i, key, j, snapshot: [...a], line: 5 };
            a[j+g] = a[j];
            yield { type: 'shift', g, i, key, j, snapshot: [...a], line: 6 };
            j -= g;
            yield { type: 'decj', g, i, key, j, snapshot: [...a], line: 7 };
          }
          yield { type: 'compare-end', g, i, key, j, snapshot: [...a], line: 5 };
          a[j+g] = key;
          yield { type: 'insert', g, i, key, j, snapshot: [...a], line: 8 };
        }
      }
      yield { type: 'done', snapshot: [...a], line: 0 };
    }

    // -------- State --------
    const barsEl = document.getElementById('bars');
    const statComparisons = document.getElementById('statComparisons');
    const statMoves = document.getElementById('statMoves');
    const statSize = document.getElementById('statSize');
    const btnPlay = document.getElementById('btnPlay');
    const btnStep = document.getElementById('btnStep');
    const btnReset = document.getElementById('btnReset');
    const btnShuffle = document.getElementById('btnShuffle');
    const rangeSpeed = document.getElementById('rangeSpeed');
    const rangeSize = document.getElementById('rangeSize');
    const PSEUDO = document.getElementById('pseudocode');
    const gapModeSel = document.getElementById('gapMode');
    const curGapEl = document.getElementById('curGap');

    let arr = rngArray(parseInt(rangeSize.value, 10));
    let gaps = getGaps(arr.length, gapModeSel.value);
    let steps = Array.from(shellSortSteps(arr, gaps));
    let stepIdx = 0;
    let running = false;

    // Visual state
    let keyVal = null;  // cyan
    let jScan = null;   // amber
    let shiftIdx = null;// rose (destination of shift)
    let gVal = gaps[0] || 1; // current gap

    let comparisons = 0;
    let moves = 0;
    let timer = null;

    function maxVal(a){ return a.length ? Math.max(...a) : 1; }

    // -------- Rendering --------
    function renderBars() {
      const M = maxVal(arr);
      barsEl.innerHTML = '';
      arr.forEach((v, idx) => {
        const h = Math.max(4, (v / M) * 100);
        let cls = 'bg-slate-400';
        // Highlight interleaved subsequences faintly by modulo class for the current gap
        if (gVal > 1 && idx % gVal === 0) cls = 'bg-slate-300';
        const isScan = (jScan === idx);
        const isShift = (shiftIdx === idx);
        const isKey = (keyVal !== null && v === keyVal && (idx % gVal === (jScan!==null? (jScan+gVal)%gVal : idx%gVal)));
        if (isScan) cls = 'bg-amber-400';
        if (isShift) cls = 'bg-rose-400';
        if (isKey) cls = 'bg-cyan-400';
        const d = document.createElement('div');
        d.className = `w-full max-w-[16px] flex-1 rounded-t-lg transition-all duration-300 ease-out ${cls}`;
        d.style.height = h + '%';
        d.title = `A[${idx}] = ${v}`;
        barsEl.appendChild(d);
      });
    }

    function setPseudoHighlight(line){
      PSEUDO.querySelectorAll('[data-line]').forEach(x => {
        x.classList.remove('bg-emerald-700/30');
        x.querySelectorAll('span').forEach(s => s.classList.remove('text-emerald-300'));
      });
      if (line > 0){
        const el = PSEUDO.querySelector(`[data-line="${line}"]`);
        if (el){
          el.classList.add('bg-emerald-700/30');
          const spans = el.querySelectorAll('span');
          if (spans.length) spans[spans.length-1].classList.add('text-emerald-300');
        }
      }
    }

    function rebuild(){
      gaps = getGaps(arr.length, gapModeSel.value);
      steps = Array.from(shellSortSteps(arr, gaps));
      stepIdx = 0; running = false;
      keyVal = null; jScan = null; shiftIdx = null; gVal = gaps[0] || 1;
      comparisons = 0; moves = 0;
      statComparisons.textContent = '0';
      statMoves.textContent = '0';
      statSize.textContent = String(arr.length);
      btnPlay.textContent = 'Play';
      clearInterval(timer); timer = null;
      setPseudoHighlight(0);
      curGapEl.textContent = gVal || '1';
      renderBars();
    }

    function resetState(newArr){
      arr = [...newArr];
      rebuild();
    }

    function applyStep(s){
      setPseudoHighlight(s.line || 0);
      shiftIdx = null;
      if (s.type === 'gap'){
        gVal = s.g; curGapEl.textContent = gVal;
        arr = s.snapshot;
      } else if (s.type === 'outer' || s.type === 'prep'){
        keyVal = s.key; jScan = s.j; gVal = s.g; curGapEl.textContent = gVal;
        arr = s.snapshot;
      } else if (s.type === 'compare'){
        comparisons += 1; statComparisons.textContent = String(comparisons);
        jScan = s.j; arr = s.snapshot; gVal = s.g; curGapEl.textContent = gVal;
      } else if (s.type === 'shift'){
        moves += 1; statMoves.textContent = String(moves);
        shiftIdx = s.j + s.g; arr = s.snapshot;
      } else if (s.type === 'decj'){
        jScan = s.j; arr = s.snapshot;
      } else if (s.type === 'compare-end'){
        jScan = s.j; arr = s.snapshot;
      } else if (s.type === 'insert'){
        arr = s.snapshot; keyVal = s.key; jScan = s.j;
      } else if (s.type === 'done'){
        keyVal = null; jScan = null; shiftIdx = null; gVal = 1; curGapEl.textContent = '1';
        running = false; btnPlay.textContent = 'Play';
        clearInterval(timer); timer = null;
      }
      renderBars();
    }

    function stepOnce(){
      if (stepIdx >= steps.length) return;
      const s = steps[stepIdx];
      applyStep(s);
      stepIdx += 1;
    }

    function playLoop(){
      clearInterval(timer);
      const delay = Math.max(30, Number(rangeSpeed.max) - Number(rangeSpeed.value) + Number(rangeSpeed.min));
      timer = setInterval(() => {
        if (stepIdx >= steps.length){
          running = false; btnPlay.textContent = 'Play'; clearInterval(timer); timer=null; return;
        }
        stepOnce();
      }, delay);
    }

    // -------- Event bindings --------
    btnPlay.addEventListener('click', () => {
      running = !running;
      btnPlay.textContent = running ? 'Pause' : 'Play';
      if (running) playLoop(); else { clearInterval(timer); timer = null; }
    });

    btnStep.addEventListener('click', () => { if (!running) stepOnce(); });

    btnReset.addEventListener('click', () => { resetState(arr); });

    btnShuffle.addEventListener('click', () => {
      const n = parseInt(rangeSize.value,10);
      resetState(rngArray(n));
    });

    rangeSize.addEventListener('input', () => {
      const n = parseInt(rangeSize.value,10);
      statSize.textContent = String(n);
    });

    rangeSize.addEventListener('change', () => {
      const n = parseInt(rangeSize.value,10);
      resetState(rngArray(n));
    });

    rangeSpeed.addEventListener('change', () => { if (running) playLoop(); });

    gapModeSel.addEventListener('change', () => { rebuild(); });

    // -------- Initial render --------
    resetState(arr);
  </script>
</body>
</html>