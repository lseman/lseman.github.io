<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bubble Sort — Interactive Visualizer (Vanilla JS + Tailwind)</title>
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen w-full bg-gradient-to-br from-indigo-50 via-sky-50 to-emerald-50 text-slate-800">
  <div class="mx-auto max-w-6xl px-5 py-8">
    <header>
      <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight text-slate-900">Bubble Sort — Interactive Visualizer</h1>
      <p class="mt-2 text-slate-600 max-w-3xl">
        Explore how Bubble Sort works step-by-step. Watch adjacent pairs compare and swap, see passes push the largest
        elements to the end, and connect the animation to the algorithm and its complexity.
      </p>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-3 gap-6 pb-16 mt-6">
      <!-- Left: Visualization -->
      <section class="lg:col-span-2 flex flex-col gap-4">
        <div class="rounded-3xl border border-slate-200 bg-white p-4 shadow-sm">
          <div class="flex flex-wrap items-center gap-2 mb-3">
            <button id="btnPlay" class="px-3 py-2 rounded-xl shadow-sm border bg-white hover:bg-slate-50 text-sm font-medium">Play</button>
            <button id="btnStep" class="px-3 py-2 rounded-xl shadow-sm border bg-white hover:bg-slate-50 text-sm">Step</button>
            <button id="btnReset" class="px-3 py-2 rounded-xl shadow-sm border bg-white hover:bg-slate-50 text-sm">Reset</button>
            <button id="btnShuffle" class="px-3 py-2 rounded-xl shadow-sm border bg-white hover:bg-slate-50 text-sm">Shuffle</button>

            <div class="ml-auto flex items-center gap-3">
              <label class="text-sm text-slate-600">Speed</label>
              <input id="rangeSpeed" type="range" min="50" max="1500" value="400" class="w-40">
              <label class="text-sm text-slate-600">Size</label>
              <input id="rangeSize" type="range" min="6" max="64" value="24" class="w-40">
            </div>
          </div>

          <div id="bars" class="relative w-full h-64 md:h-72 lg:h-80 flex items-end gap-1 p-2 rounded-2xl bg-gradient-to-b from-white to-slate-100 border border-slate-200"></div>

          <div class="mt-4 grid grid-cols-3 gap-3">
            <div class="flex flex-col items-center justify-center rounded-2xl bg-white/60 backdrop-blur p-3 shadow-sm">
              <div class="text-xs uppercase tracking-wide text-slate-500">Comparisons</div>
              <div id="statComparisons" class="text-xl font-semibold tabular-nums text-slate-900">0</div>
            </div>
            <div class="flex flex-col items-center justify-center rounded-2xl bg-white/60 backdrop-blur p-3 shadow-sm">
              <div class="text-xs uppercase tracking-wide text-slate-500">Swaps</div>
              <div id="statSwaps" class="text-xl font-semibold tabular-nums text-slate-900">0</div>
            </div>
            <div class="flex flex-col items-center justify-center rounded-2xl bg-white/60 backdrop-blur p-3 shadow-sm">
              <div class="text-xs uppercase tracking-wide text-slate-500">Array Size</div>
              <div id="statSize" class="text-xl font-semibold tabular-nums text-slate-900">24</div>
            </div>
          </div>
        </div>

        <div class="rounded-3xl border border-slate-200 bg-white p-4 shadow-sm">
          <h3 class="text-lg font-semibold mb-2">Pseudocode</h3>
          <pre id="pseudocode" class="rounded-2xl p-4 bg-slate-900 text-slate-100 text-sm leading-6 overflow-auto"><code>
<span data-line="1" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">01</span>for i = 0 .. n-2:</span>
<span data-line="2" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">02</span>  swapped ← false</span>
<span data-line="3" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">03</span>  for j = 0 .. n-2-i:</span>
<span data-line="4" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">04</span>    if A[j] &gt; A[j+1]:</span>
<span data-line="5" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">05</span>      swap(A[j], A[j+1]); swapped ← true</span>
<span data-line="6" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">06</span>  if not swapped: break</span>
          </code></pre>
        </div>
      </section>

      <!-- Right: Theory & Complexity -->
      <aside class="flex flex-col gap-4">
        <div class="rounded-3xl border border-slate-200 bg-white p-5 shadow-sm">
          <h3 class="text-lg font-semibold">How Bubble Sort Works</h3>
          <p class="mt-2 text-sm leading-6 text-slate-600">
            Bubble Sort repeatedly steps through the list, compares adjacent pairs, and swaps them if they are in the wrong order.
            After each full pass, the largest remaining element bubbles up to its final position at the end.
            The process repeats on the unsorted prefix until no swaps are needed.
          </p>
          <ul class="mt-3 text-sm text-slate-700 list-disc pl-5 space-y-1">
            <li><span class="font-medium text-amber-700">Amber</span> bars indicate the pair currently being compared.</li>
            <li><span class="font-medium text-rose-700">Rose</span> bars indicate a swap just happened.</li>
            <li><span class="font-medium text-emerald-700">Emerald</span> bars are already in their final positions.</li>
          </ul>
        </div>

        <div class="rounded-3xl border border-slate-200 bg-white p-5 shadow-sm">
          <h3 class="text-lg font-semibold">Complexity</h3>
          <div class="mt-2 grid grid-cols-2 gap-3 text-sm">
            <div class="rounded-xl bg-slate-50 p-3 border border-slate-200">
              <div class="text-slate-500 text-xs uppercase">Time</div>
              <ul class="mt-1 space-y-1">
                <li><span class="font-semibold">Worst:</span> O(n²)</li>
                <li><span class="font-semibold">Average:</span> O(n²)</li>
                <li><span class="font-semibold">Best:</span> O(n) with early‑exit</li>
              </ul>
            </div>
            <div class="rounded-xl bg-slate-50 p-3 border border-slate-200">
              <div class="text-slate-500 text-xs uppercase">Space</div>
              <p class="mt-1">O(1) extra memory (in‑place)</p>
            </div>
          </div>
          <p class="mt-3 text-sm text-slate-600">
            The inner loop performs at most <span class="font-mono">n−1−i</span> comparisons on pass <span class="font-mono">i</span>.
            Summing over passes yields <span class="font-mono">∑<sub>i=0</sub><sup>n-2</sup> (n-1-i) = (n−1)n/2 = O(n²)</span> comparisons in the worst case.
            With the “swapped” early‑exit, a sorted input finishes after one pass: O(n).
          </p>
        </div>

        <div class="rounded-3xl border border-slate-200 bg-white p-5 shadow-sm">
          <h3 class="text-lg font-semibold">Try These Experiments</h3>
          <ol class="mt-2 list-decimal pl-5 space-y-2 text-sm text-slate-700">
            <li>Set a small size (e.g., 8), shuffle, then <span class="font-medium">Step</span> through to understand each comparison.</li>
            <li>Increase the size to 40–60 and <span class="font-medium">Play</span> at different speeds; watch the green tail grow after each pass.</li>
            <li>Start with a nearly sorted array (shuffle until it looks sorted) and notice the early exit: best‑case O(n).</li>
          </ol>
        </div>
      </aside>
    </main>

    <footer class="text-center text-xs text-slate-500 pb-4">Built with ❤️ for learning. Use sliders to explore performance and behavior.</footer>
  </div>

  <script>
    // -------- Utilities --------
    function rngArray(n, min = 5, max = 100) {
      return Array.from({ length: n }, () => Math.floor(min + Math.random() * (max - min + 1)));
    }

    function* bubbleSortSteps(original) {
      const a = [...original];
      const n = a.length;
      let swapped;
      for (let pass = 0; pass < n - 1; pass++) {
        swapped = false; // line 2
        yield { type: 'outer', pass, idx: null, snapshot: [...a], line: 1 };
        yield { type: 'set-swapped', pass, idx: null, snapshot: [...a], line: 2 };
        for (let idx = 0; idx < n - 1 - pass; idx++) {
          yield { type: 'compare', pass, idx, snapshot: [...a], line: 4 };
          if (a[idx] > a[idx + 1]) {
            [a[idx], a[idx + 1]] = [a[idx + 1], a[idx]];
            swapped = true;
            yield { type: 'swap', pass, idx, snapshot: [...a], line: 5 };
          }
        }
        yield { type: 'post-pass', pass, idx: null, snapshot: [...a], line: 6, swapped };
        if (!swapped) break;
      }
      yield { type: 'done', pass: null, idx: null, snapshot: [...a], line: 0 };
    }

    // -------- State --------
    const barsEl = document.getElementById('bars');
    const statComparisons = document.getElementById('statComparisons');
    const statSwaps = document.getElementById('statSwaps');
    const statSize = document.getElementById('statSize');
    const btnPlay = document.getElementById('btnPlay');
    const btnStep = document.getElementById('btnStep');
    const btnReset = document.getElementById('btnReset');
    const btnShuffle = document.getElementById('btnShuffle');
    const rangeSpeed = document.getElementById('rangeSpeed');
    const rangeSize = document.getElementById('rangeSize');

    const PSEUDO = document.getElementById('pseudocode');

    let arr = rngArray(parseInt(rangeSize.value, 10));
    let steps = Array.from(bubbleSortSteps(arr));
    let stepIdx = 0;
    let running = false;
    let sortedTail = 0; // number of elements at end confirmed sorted
    let compareIdx = null; // highlight pair j and j+1
    let swapIdx = null;    // highlight last swap pair center at j+1
    let comparisons = 0;
    let swaps = 0;
    let timer = null;

    function maxVal(a){ return a.length ? Math.max(...a) : 1; }

    // -------- Rendering --------
    function renderBars() {
      const M = maxVal(arr);
      barsEl.innerHTML = '';
      arr.forEach((v, i) => {
        const h = Math.max(4, (v / M) * 100);
        let cls = 'bg-slate-400';
        const isCompare = compareIdx === i || compareIdx === i - 1;
        const isSwap = swapIdx === i || swapIdx === i - 1;
        const isSorted = i >= arr.length - sortedTail;
        if (isSorted) cls = 'bg-emerald-400';
        if (isCompare) cls = 'bg-amber-400';
        if (isSwap) cls = 'bg-rose-400';
        const d = document.createElement('div');
        d.className = `w-full max-w-[18px] flex-1 rounded-t-lg transition-all duration-300 ease-out ${cls}`;
        d.style.height = h + '%';
        d.title = `A[${i}] = ${v}`;
        barsEl.appendChild(d);
      });
    }

    function setPseudoHighlight(line){
      PSEUDO.querySelectorAll('[data-line]').forEach(x => {
        x.classList.remove('bg-emerald-700/30');
        x.querySelectorAll('span').forEach(s => s.classList.remove('text-emerald-300'));
      });
      if (line > 0){
        const el = PSEUDO.querySelector(`[data-line="${line}"]`);
        if (el){
          el.classList.add('bg-emerald-700/30');
          const spans = el.querySelectorAll('span');
          if (spans.length) spans[spans.length-1].classList.add('text-emerald-300');
        }
      }
    }

    function resetState(newArr){
      arr = [...newArr];
      steps = Array.from(bubbleSortSteps(arr));
      stepIdx = 0; running = false; sortedTail = 0; compareIdx = null; swapIdx = null;
      comparisons = 0; swaps = 0;
      statComparisons.textContent = '0';
      statSwaps.textContent = '0';
      statSize.textContent = String(arr.length);
      btnPlay.textContent = 'Play';
      clearInterval(timer); timer = null;
      setPseudoHighlight(0);
      renderBars();
    }

    function applyStep(s){
      setPseudoHighlight(s.line || 0);
      if (s.type === 'compare'){
        comparisons += 1; statComparisons.textContent = String(comparisons);
        compareIdx = s.idx + 1; swapIdx = null; arr = s.snapshot; // show snapshot before potential swap
      } else if (s.type === 'swap'){
        swaps += 1; statSwaps.textContent = String(swaps);
        swapIdx = s.idx + 1; compareIdx = null; arr = s.snapshot;
      } else if (s.type === 'outer'){
        sortedTail = 0; compareIdx = null; swapIdx = null;
      } else if (s.type === 'post-pass'){
        const tail = Math.max(0, (s.pass || 0) + 1);
        sortedTail = tail;
      } else if (s.type === 'done'){
        sortedTail = arr.length; compareIdx = null; swapIdx = null; running = false; btnPlay.textContent = 'Play';
        clearInterval(timer); timer = null;
      } else {
        arr = s.snapshot;
      }
      renderBars();
    }

    function stepOnce(){
      if (stepIdx >= steps.length) return;
      const s = steps[stepIdx];
      applyStep(s);
      stepIdx += 1;
    }

    function playLoop(){
      clearInterval(timer);
      const delay = Math.max(30, parseInt(rangeSpeed.value,10));
      timer = setInterval(() => {
        if (stepIdx >= steps.length){ running = false; btnPlay.textContent = 'Play'; clearInterval(timer); timer=null; return; }
        stepOnce();
      }, delay);
    }

    // -------- Event bindings --------
    btnPlay.addEventListener('click', () => {
      running = !running;
      btnPlay.textContent = running ? 'Pause' : 'Play';
      if (running) playLoop(); else { clearInterval(timer); timer = null; }
    });

    btnStep.addEventListener('click', () => { if (!running) stepOnce(); });

    btnReset.addEventListener('click', () => { resetState(arr); });

    btnShuffle.addEventListener('click', () => {
      const n = parseInt(rangeSize.value,10);
      resetState(rngArray(n));
    });

    rangeSize.addEventListener('input', () => {
      const n = parseInt(rangeSize.value,10);
      statSize.textContent = String(n);
    });

    rangeSize.addEventListener('change', () => {
      const n = parseInt(rangeSize.value,10);
      resetState(rngArray(n));
    });

    rangeSpeed.addEventListener('change', () => {
      if (running) playLoop();
    });

    // -------- Initial render --------
    resetState(arr);
  </script>
</body>
</html>
