<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Binary Insertion Sort — Interactive Visualizer (Vanilla JS + Tailwind)</title>
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen w-full bg-gradient-to-br from-indigo-50 via-sky-50 to-emerald-50 text-slate-800">
  <div class="mx-auto max-w-6xl px-5 py-8">
    <header>
      <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight text-slate-900">Binary Insertion Sort — Interactive Visualizer</h1>
      <p class="mt-2 text-slate-600 max-w-3xl">
        Binary Insertion Sort improves upon classic insertion sort by using <b>binary search</b> to locate the position of each key within the sorted prefix.
        It reduces comparisons from O(n²) to O(n log n), but still requires O(n²) shifts.
      </p>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-3 gap-6 pb-16 mt-6">
      <!-- Left: Visualization -->
      <section class="lg:col-span-2 flex flex-col gap-4">
        <div class="rounded-3xl border border-slate-200 bg-white p-4 shadow-sm">
          <div class="flex flex-wrap items-center gap-2 mb-3">
            <button id="btnPlay" class="px-3 py-2 rounded-xl shadow-sm border bg-white hover:bg-slate-50 text-sm font-medium">Play</button>
            <button id="btnStep" class="px-3 py-2 rounded-xl shadow-sm border bg-white hover:bg-slate-50 text-sm">Step</button>
            <button id="btnReset" class="px-3 py-2 rounded-xl shadow-sm border bg-white hover:bg-slate-50 text-sm">Reset</button>
            <button id="btnShuffle" class="px-3 py-2 rounded-xl shadow-sm border bg-white hover:bg-slate-50 text-sm">Shuffle</button>

            <div class="ml-auto flex items-center gap-3">
              <label class="text-sm text-slate-600">Speed</label>
              <input id="rangeSpeed" type="range" min="50" max="1500" value="400" class="w-40">
              <label class="text-sm text-slate-600">Size</label>
              <input id="rangeSize" type="range" min="6" max="64" value="24" class="w-40">
            </div>
          </div>

          <div id="bars" class="relative w-full h-64 md:h-72 lg:h-80 flex items-end gap-1 p-2 rounded-2xl bg-gradient-to-b from-white to-slate-100 border border-slate-200"></div>

          <div class="mt-4 grid grid-cols-3 gap-3">
            <div class="flex flex-col items-center justify-center rounded-2xl bg-white/60 backdrop-blur p-3 shadow-sm">
              <div class="text-xs uppercase tracking-wide text-slate-500">Comparisons</div>
              <div id="statComparisons" class="text-xl font-semibold tabular-nums text-slate-900">0</div>
            </div>
            <div class="flex flex-col items-center justify-center rounded-2xl bg-white/60 backdrop-blur p-3 shadow-sm">
              <div class="text-xs uppercase tracking-wide text-slate-500">Shifts</div>
              <div id="statMoves" class="text-xl font-semibold tabular-nums text-slate-900">0</div>
            </div>
            <div class="flex flex-col items-center justify-center rounded-2xl bg-white/60 backdrop-blur p-3 shadow-sm">
              <div class="text-xs uppercase tracking-wide text-slate-500">Array Size</div>
              <div id="statSize" class="text-xl font-semibold tabular-nums text-slate-900">24</div>
            </div>
          </div>
        </div>

        <div class="rounded-3xl border border-slate-200 bg-white p-4 shadow-sm">
          <h3 class="text-lg font-semibold mb-2">Pseudocode</h3>
          <pre id="pseudocode" class="rounded-2xl p-4 bg-slate-900 text-slate-100 text-sm leading-6 overflow-auto"><code>
<span data-line="1" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">01</span>for i = 1 .. n-1:</span>
<span data-line="2" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">02</span>  key ← A[i]</span>
<span data-line="3" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">03</span>  pos ← binarySearch(A, 0, i-1, key)</span>
<span data-line="4" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">04</span>  shift elements right from pos..i-1</span>
<span data-line="5" class="block px-2 rounded-md"><span class="text-slate-400 mr-3 select-none">05</span>  A[pos] ← key</span>
          </code></pre>
        </div>
      </section>

      <!-- Right: Theory & Complexity -->
      <aside class="flex flex-col gap-4">
        <div class="rounded-3xl border border-slate-200 bg-white p-5 shadow-sm">
          <h3 class="text-lg font-semibold">How Binary Insertion Sort Works</h3>
          <p class="mt-2 text-sm leading-6 text-slate-600">
            Instead of scanning linearly for the insertion point, binary search finds it in O(log n) comparisons. Then the elements are shifted to make room for the key.
          </p>
          <ul class="mt-3 text-sm text-slate-700 list-disc pl-5 space-y-1">
            <li><span class="font-medium text-cyan-700">Cyan</span>: the key being inserted.</li>
            <li><span class="font-medium text-amber-700">Amber</span>: current midpoint in binary search.</li>
            <li><span class="font-medium text-rose-700">Rose</span>: elements being shifted.</li>
            <li><span class="font-medium text-emerald-700">Emerald</span>: prefix already sorted.</li>
          </ul>
        </div>

        <div class="rounded-3xl border border-slate-200 bg-white p-5 shadow-sm">
          <h3 class="text-lg font-semibold">Complexity</h3>
          <div class="mt-2 grid grid-cols-2 gap-3 text-sm">
            <div class="rounded-xl bg-slate-50 p-3 border border-slate-200">
              <div class="text-slate-500 text-xs uppercase">Time</div>
              <ul class="mt-1 space-y-1">
                <li><span class="font-semibold">Worst:</span> O(n²) (shifts)</li>
                <li><span class="font-semibold">Average:</span> O(n²)</li>
                <li><span class="font-semibold">Comparisons:</span> O(n log n)</li>
              </ul>
            </div>
            <div class="rounded-xl bg-slate-50 p-3 border border-slate-200">
              <div class="text-slate-500 text-xs uppercase">Space</div>
              <p class="mt-1">O(1) extra memory, stable if shifts are stable.</p>
            </div>
          </div>
        </div>
      </aside>
    </main>

    <footer class="text-center text-xs text-slate-500 pb-4">Built for learning. Visualizes binary search + shifts in insertion sort.</footer>
  </div>

  <script>
    // -------- Utilities --------
    function rngArray(n, min = 5, max = 100) {
      return Array.from({ length: n }, () => Math.floor(min + Math.random() * (max - min + 1)));
    }

    function binarySearch(a, lo, hi, key){
      let l = lo, r = hi;
      while (l <= r){
        const m = Math.floor((l+r)/2);
        if (a[m] === key) return m+1; // place after equal elements
        if (a[m] < key) l = m+1; else r = m-1;
      }
      return l;
    }

    function* binaryInsertionSteps(original){
      const a = [...original];
      const n = a.length;
      for (let i=1;i<n;i++){
        const key = a[i];
        yield {type:'outer', i, key, snapshot:[...a], line:1};
        let pos = binarySearch(a, 0, i-1, key);
        yield {type:'search', i, key, pos, snapshot:[...a], line:3};
        for (let j=i-1;j>=pos;j--){
          a[j+1]=a[j];
          yield {type:'shift', i, j, key, pos, snapshot:[...a], line:4};
        }
        a[pos]=key;
        yield {type:'insert', i, pos, key, snapshot:[...a], line:5};
      }
      yield {type:'done', snapshot:[...a], line:0};
    }

    // -------- State --------
    const barsEl = document.getElementById('bars');
    const statComparisons = document.getElementById('statComparisons');
    const statMoves = document.getElementById('statMoves');
    const statSize = document.getElementById('statSize');
    const btnPlay = document.getElementById('btnPlay');
    const btnStep = document.getElementById('btnStep');
    const btnReset = document.getElementById('btnReset');
    const btnShuffle = document.getElementById('btnShuffle');
    const rangeSpeed = document.getElementById('rangeSpeed');
    const rangeSize = document.getElementById('rangeSize');
    const PSEUDO = document.getElementById('pseudocode');

    let arr = rngArray(parseInt(rangeSize.value, 10));
    let steps = Array.from(binaryInsertionSteps(arr));
    let stepIdx = 0;
    let running = false;

    let comparisons = 0;
    let moves = 0;
    let timer = null;

    let keyVal=null; let posVal=null; let jScan=null;

    function maxVal(a){ return a.length ? Math.max(...a) : 1; }

    function renderBars(){
      const M=maxVal(arr);
      barsEl.innerHTML='';
      arr.forEach((v,idx)=>{
        const h=Math.max(4,(v/M)*100);
        let cls='bg-slate-400';
        if (idx<stepIdx) cls='bg-emerald-400';
        if (idx===jScan) cls='bg-amber-400';
        if (idx===posVal) cls='bg-cyan-400';
        const d=document.createElement('div');
        d.className=`w-full max-w-[18px] flex-1 rounded-t-lg transition-all duration-300 ease-out ${cls}`;
        d.style.height=h+'%';
        d.title=`A[${idx}]=${v}`;
        barsEl.appendChild(d);
      });
    }

    function setPseudoHighlight(line){
      PSEUDO.querySelectorAll('[data-line]').forEach(x=>{
        x.classList.remove('bg-emerald-700/30');
        x.querySelectorAll('span').forEach(s=>s.classList.remove('text-emerald-300'));
      });
      if (line>0){
        const el=PSEUDO.querySelector(`[data-line="${line}"]`);
        if (el){
          el.classList.add('bg-emerald-700/30');
          const spans=el.querySelectorAll('span');
          if (spans.length) spans[spans.length-1].classList.add('text-emerald-300');
        }
      }
    }

    function resetState(newArr){
      arr=[...newArr];
      steps=Array.from(binaryInsertionSteps(arr));
      stepIdx=0; running=false;
      comparisons=0; moves=0;
      statComparisons.textContent='0';
      statMoves.textContent='0';
      statSize.textContent=String(arr.length);
      btnPlay.textContent='Play';
      clearInterval(timer); timer=null;
      setPseudoHighlight(0);
      renderBars();
    }

    function applyStep(s){
      setPseudoHighlight(s.line||0);
      keyVal=s.key??null; posVal=s.pos??null; jScan=s.j??null;
      if (s.type==='search'){
        comparisons += Math.ceil(Math.log2(arr.length));
        statComparisons.textContent=String(comparisons);
      } else if (s.type==='shift'){
        moves++; statMoves.textContent=String(moves);
      }
      arr=s.snapshot;
      renderBars();
      if (s.type==='done'){running=false;btnPlay.textContent='Play';clearInterval(timer);timer=null;}
    }

    function stepOnce(){
      if (stepIdx>=steps.length)return;
      const s=steps[stepIdx];
      applyStep(s);
      stepIdx++;
    }

    function playLoop(){
      clearInterval(timer);
      const delay=Math.max(30,Number(rangeSpeed.max)-Number(rangeSpeed.value)+Number(rangeSpeed.min));
      timer=setInterval(()=>{
        if (stepIdx>=steps.length){running=false;btnPlay.textContent='Play';clearInterval(timer);timer=null;return;}
        stepOnce();
      },delay);
    }

    btnPlay.addEventListener('click',()=>{running=!running;btnPlay.textContent=running?'Pause':'Play';if(running)playLoop();else{clearInterval(timer);timer=null;}});
    btnStep.addEventListener('click',()=>{if(!running)stepOnce();});
    btnReset.addEventListener('click',()=>{resetState(arr);});
    btnShuffle.addEventListener('click',()=>{const n=parseInt(rangeSize.value,10);resetState(rngArray(n));});
    rangeSize.addEventListener('input',()=>{const n=parseInt(rangeSize.value,10);statSize.textContent=String(n);});
    rangeSize.addEventListener('change',()=>{const n=parseInt(rangeSize.value,10);resetState(rngArray(n));});
    rangeSpeed.addEventListener('change',()=>{if(running)playLoop();});

    resetState(arr);
  </script>
</body>
</html>
