<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   viewBox="0 0 1182 316.5"
   version="1.1"
   id="svg84"
   sodipodi:docname="gru_cell_diagram.svg"
   inkscape:version="1.4 (e7c3feb1, 2024-10-09)"
   width="1182"
   height="316.5"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:xlink="http://www.w3.org/1999/xlink"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview84"
     pagecolor="#ffffff"
     bordercolor="#000000"
     borderopacity="0.25"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:zoom="1.0607561"
     inkscape:cx="456.74969"
     inkscape:cy="283.75987"
     inkscape:window-width="1800"
     inkscape:window-height="1039"
     inkscape:window-x="0"
     inkscape:window-y="44"
     inkscape:window-maximized="1"
     inkscape:current-layer="svg84" />
  <defs
     id="defs12">
    <!-- Gradients for different components -->
<linearGradient id="gateGrad" x1="0" y1="0" x2="0" y2="1">
  <!-- warm sand -->
  <stop offset="0%"  style="stop-color:#F2E4C2;stop-opacity:1" />
  <stop offset="100%" style="stop-color:#D3B67A;stop-opacity:1" />
</linearGradient>

<linearGradient id="activationGrad" x1="0" y1="0" x2="0" y2="1">
  <!-- soft lavender -->
  <stop offset="0%"  style="stop-color:#E3DDF6;stop-opacity:1" />
  <stop offset="100%" style="stop-color:#B9A6E6;stop-opacity:1" />
</linearGradient>

<linearGradient id="hiddenGrad" x1="0" y1="0" x2="0" y2="1">
  <!-- muted teal -->
  <stop offset="0%"  style="stop-color:#DCEFF2;stop-opacity:1" />
  <stop offset="100%" style="stop-color:#8BBCC6;stop-opacity:1" />
</linearGradient>

<linearGradient id="inputGrad" x1="0" y1="0" x2="0" y2="1">
  <!-- pale rose -->
  <stop offset="0%"  style="stop-color:#F3E0EB;stop-opacity:1" />
  <stop offset="100%" style="stop-color:#D8AFC3;stop-opacity:1" />
</linearGradient>

<linearGradient id="candidateGrad"
  x1="505.98828" y1="357.85612"
  x2="505.98828" y2="437.3797"
  gradientTransform="scale(1.2826384,0.77964295)"
  gradientUnits="userSpaceOnUse">
  <!-- soft sage -->
  <stop offset="0%"  style="stop-color:#DDEEE4;stop-opacity:1" />
  <stop offset="100%" style="stop-color:#9BC8A7;stop-opacity:1" />
</linearGradient>

    <!-- Arrow markers -->
    <marker
       id="arrowhead"
       markerWidth="8"
       markerHeight="6"
       refX="7"
       refY="3"
       orient="auto">
      <polygon
         points="8,3 0,6 0,0 "
         fill="#374151"
         id="polygon10" />
    </marker>
    <marker
       id="hiddenArrow"
       markerWidth="8"
       markerHeight="6"
       refX="7"
       refY="3"
       orient="auto">
      <polygon
         points="8,3 0,6 0,0 "
         fill="#0891b2"
         id="polygon11" />
    </marker>
    <marker
       id="gateArrow"
       markerWidth="8"
       markerHeight="6"
       refX="7"
       refY="3"
       orient="auto">
      <polygon
         points="8,3 0,6 0,0 "
         fill="#f59e0b"
         id="polygon12" />
    </marker>
    <linearGradient
       inkscape:collect="always"
       xlink:href="#hiddenGrad"
       id="linearGradient89"
       x1="35.068226"
       y1="278.05798"
       x2="35.068226"
       y2="336.74358"
       gradientTransform="scale(1.3972763,0.71567809)"
       gradientUnits="userSpaceOnUse" />
    <linearGradient
       inkscape:collect="always"
       xlink:href="#inputGrad"
       id="linearGradient90"
       x1="35.068226"
       y1="417.7856"
       x2="35.068226"
       y2="476.47121"
       gradientTransform="scale(1.3972763,0.71567809)"
       gradientUnits="userSpaceOnUse" />
    <linearGradient
       inkscape:collect="always"
       xlink:href="#inputGrad"
       id="linearGradient91"
       x1="174"
       y1="224"
       x2="174"
       y2="276"
       gradientUnits="userSpaceOnUse" />
    <linearGradient
       inkscape:collect="always"
       xlink:href="#gateGrad"
       id="linearGradient92"
       x1="233.11324"
       y1="191.11312"
       x2="233.11324"
       y2="270.6367"
       gradientTransform="scale(1.2826384,0.77964295)"
       gradientUnits="userSpaceOnUse" />
    <linearGradient
       inkscape:collect="always"
       xlink:href="#activationGrad"
       id="linearGradient93"
       x1="335.70821"
       y1="210.01664"
       x2="335.70821"
       y2="250.29381"
       gradientTransform="scale(1.2786402,0.78208087)"
       gradientUnits="userSpaceOnUse" />
    <linearGradient
       inkscape:collect="always"
       xlink:href="#gateGrad"
       id="linearGradient94"
       x1="233.11324"
       y1="293.7242"
       x2="233.11324"
       y2="373.24778"
       gradientTransform="scale(1.2826384,0.77964295)"
       gradientUnits="userSpaceOnUse" />
    <linearGradient
       inkscape:collect="always"
       xlink:href="#activationGrad"
       id="linearGradient95"
       x1="335.70821"
       y1="312.30786"
       x2="335.70821"
       y2="352.58502"
       gradientTransform="scale(1.2786402,0.78208087)"
       gradientUnits="userSpaceOnUse" />
    <linearGradient
       inkscape:collect="always"
       xlink:href="#activationGrad"
       id="linearGradient96"
       x1="609.43652"
       y1="376.23986"
       x2="609.43652"
       y2="416.51703"
       gradientTransform="scale(1.2786402,0.78208087)"
       gradientUnits="userSpaceOnUse" />
    <linearGradient
       inkscape:collect="always"
       xlink:href="#hiddenGrad"
       id="linearGradient97"
       x1="1054"
       y1="254"
       x2="1054"
       y2="306"
       gradientUnits="userSpaceOnUse" />
    <linearGradient
       inkscape:collect="always"
       xlink:href="#hiddenGrad"
       id="linearGradient98"
       x1="822.31412"
       y1="361.89455"
       x2="822.31412"
       y2="420.58015"
       gradientTransform="scale(1.3972763,0.71567809)"
       gradientUnits="userSpaceOnUse" />
  </defs>
  <!-- Background -->
  <!-- Title -->
  <!-- Input Section -->
  <g
     id="inputs"
     transform="translate(-49,-84.5)">
    <!-- Previous hidden state h(t-1) -->
    <rect
       x="50"
       y="200"
       width="80"
       height="40"
       rx="5"
       fill="url(#hiddenGrad)"
       stroke="#0891b2"
       stroke-width="2"
       id="rect13"
       style="fill:url(#linearGradient89)"
       ry="5" />
    <text
       x="90"
       y="225"
       text-anchor="middle"
       class="text-sm font-medium"
       fill="white"
       id="text13"
       style="fill:#000000;fill-opacity:1">h(t-1)</text>
    <!-- Current input x(t) -->
    <rect
       x="50"
       y="300"
       width="80"
       height="40"
       rx="5"
       fill="url(#inputGrad)"
       stroke="#ec4899"
       stroke-width="2"
       id="rect14"
       style="fill:url(#linearGradient90)"
       ry="5" />
    <text
       x="90"
       y="325"
       text-anchor="middle"
       class="text-sm font-medium"
       fill="white"
       id="text14"
       style="fill:#000000;fill-opacity:1">x(t)</text>
  </g>
  <!-- Concatenation Node -->
  <g
     id="concat"
     transform="translate(-49,-84.5)">
    <circle
       cx="200"
       cy="250"
       r="25"
       fill="url(#inputGrad)"
       stroke="#ec4899"
       stroke-width="2"
       id="circle14"
       style="fill:url(#linearGradient91)" />
    <text
       x="200"
       y="253"
       text-anchor="middle"
       class="text-sm font-medium"
       fill="#ffffff"
       id="text15"
       style="fill:#000000;fill-opacity:1">⊕</text>
    <text
       x="200"
       y="285"
       text-anchor="middle"
       class="text-xs"
       fill="#374151"
       id="text16">concat</text>
  </g>
  <!-- Reset Gate -->
  <g
     id="reset-gate"
     transform="translate(-49,-84.5)">
    <rect
       x="300"
       y="150"
       width="100"
       height="60"
       rx="8"
       fill="url(#gateGrad)"
       stroke="#f59e0b"
       stroke-width="2"
       id="rect16"
       style="fill:url(#linearGradient92)"
       ry="8" />
    <text
       x="350"
       y="175"
       text-anchor="middle"
       class="text-sm font-bold"
       fill="#92400e"
       id="text17">Reset Gate</text>
    <!-- Sigmoid activation -->
    <rect
       x="430"
       y="165"
       width="50"
       height="30"
       rx="5"
       fill="url(#activationGrad)"
       stroke="#8b5cf6"
       stroke-width="1.5"
       id="rect18"
       style="fill:url(#linearGradient93)"
       ry="5" />
    <text
       x="455"
       y="184"
       text-anchor="middle"
       class="text-sm font-medium"
       fill="white"
       id="text19"
       style="fill:#000000;fill-opacity:1">σ</text>
  </g>
  <!-- Update Gate -->
  <g
     id="update-gate"
     transform="translate(-49,-84.5)">
    <rect
       x="300"
       y="230"
       width="100"
       height="60"
       rx="8"
       fill="url(#gateGrad)"
       stroke="#f59e0b"
       stroke-width="2"
       id="rect19"
       style="fill:url(#linearGradient94)"
       ry="8" />
    <text
       x="350"
       y="255"
       text-anchor="middle"
       class="text-sm font-bold"
       fill="#92400e"
       id="text20">Update Gate</text>
    <!-- Sigmoid activation -->
    <rect
       x="430"
       y="245"
       width="50"
       height="30"
       rx="5"
       fill="url(#activationGrad)"
       stroke="#8b5cf6"
       stroke-width="1.5"
       id="rect21"
       style="fill:url(#linearGradient95)"
       ry="5" />
    <text
       x="455"
       y="264"
       text-anchor="middle"
       class="text-sm font-medium"
       fill="white"
       id="text22"
       style="fill:#000000;fill-opacity:1">σ</text>
  </g>
  <!-- Reset Operation -->
  <g
     id="reset-operation"
     transform="translate(-49,-84.5)">
    <circle
       cx="550"
       cy="320"
       r="20"
       fill="#ffffff"
       stroke="#374151"
       stroke-width="2"
       id="circle22" />
    <text
       x="550"
       y="327"
       text-anchor="middle"
       class="text-lg font-bold"
       fill="#374151"
       id="text23">×</text>
    <text
       x="550"
       y="350"
       text-anchor="middle"
       class="text-xs"
       fill="#374151"
       id="text24">reset</text>
  </g>
  <!-- Candidate Hidden State -->
  <g
     id="candidate-state"
     transform="translate(-49,-84.5)">
    <rect
       x="650"
       y="280"
       width="100"
       height="60"
       rx="8"
       fill="url(#candidateGrad)"
       stroke="#16a34a"
       stroke-width="2"
       id="rect24"
       style="fill:url(#candidateGrad)"
       ry="8" />
    <text
       x="700"
       y="305"
       text-anchor="middle"
       class="text-sm font-bold"
       fill="#ffffff"
       id="text25"
       style="fill:#000000;fill-opacity:1"><tspan
         sodipodi:role="line"
         id="tspan88"
         x="700"
         y="305">Candidate</tspan><tspan
         sodipodi:role="line"
         id="tspan89"
         x="700"
         y="321.25">h̃(t)</tspan></text>
    <!-- Tanh activation -->
    <rect
       x="780"
       y="295"
       width="50"
       height="30"
       rx="5"
       fill="url(#activationGrad)"
       stroke="#8b5cf6"
       stroke-width="1.5"
       id="rect26"
       style="fill:url(#linearGradient96)"
       ry="5" />
    <text
       x="805"
       y="314"
       text-anchor="middle"
       class="text-sm font-medium"
       fill="white"
       id="text27"
       style="fill:#000000;fill-opacity:1">tanh</text>
  </g>
  <!-- Final Hidden State Computation -->
  <g
     id="final-computation"
     transform="translate(-49,-84.5)">
    <!-- (1-z) operation -->
    <rect
       x="880"
       y="200"
       width="60"
       height="30"
       rx="5"
       fill="#ffffff"
       stroke="#374151"
       stroke-width="1.5"
       id="rect27"
       ry="5" />
    <text
       x="910"
       y="219"
       text-anchor="middle"
       class="text-sm"
       fill="#374151"
       id="text28">(1-z)</text>
    <!-- Multiply with previous hidden -->
    <circle
       cx="980"
       cy="240"
       r="20"
       fill="#ffffff"
       stroke="#374151"
       stroke-width="2"
       id="circle28" />
    <text
       x="980"
       y="247"
       text-anchor="middle"
       class="text-lg font-bold"
       fill="#374151"
       id="text29">×</text>
    <text
       x="980"
       y="270"
       text-anchor="middle"
       class="text-xs"
       fill="#374151"
       id="text30">keep old</text>
    <!-- Multiply with candidate -->
    <circle
       cx="980"
       cy="320"
       r="20"
       fill="#ffffff"
       stroke="#374151"
       stroke-width="2"
       id="circle30" />
    <text
       x="980"
       y="327"
       text-anchor="middle"
       class="text-lg font-bold"
       fill="#374151"
       id="text31">×</text>
    <text
       x="980"
       y="350"
       text-anchor="middle"
       class="text-xs"
       fill="#374151"
       id="text32">add new</text>
    <!-- Final addition -->
    <circle
       cx="1080"
       cy="280"
       r="25"
       fill="url(#hiddenGrad)"
       stroke="#0891b2"
       stroke-width="2"
       id="circle32"
       style="fill:url(#linearGradient97)" />
    <text
       x="1080"
       y="288"
       text-anchor="middle"
       class="text-lg font-bold"
       fill="#ffffff"
       id="text33">+</text>
    <text
       x="1080"
       y="315"
       text-anchor="middle"
       class="text-xs"
       fill="#374151"
       id="text34">new h(t)</text>
  </g>
  <!-- Output -->
  <g
     id="output"
     transform="translate(-49,-84.5)">
    <!-- New hidden state h(t) -->
    <rect
       x="1150"
       y="260"
       width="80"
       height="40"
       rx="5"
       fill="url(#hiddenGrad)"
       stroke="#0891b2"
       stroke-width="2"
       id="rect34"
       style="fill:url(#linearGradient98)"
       ry="5" />
    <text
       x="1190"
       y="285"
       text-anchor="middle"
       class="text-sm font-medium"
       fill="#ffffff"
       id="text35">h(t)</text>
  </g>
  <!-- Data Flow Connections -->
  <g
     stroke="#374151"
     stroke-width="2"
     fill="none"
     marker-end="url(#arrowhead)"
     id="g50"
     transform="translate(-49,-84.5)">
    <!-- Input connections to concat -->
    <path
       d="m 130,220 h 45 v 20"
       id="path35" />
    <path
       d="m 130,320 h 45 v -60"
       id="path36" />
    <!-- Concat to gates -->
    <path
       d="m 225,250 h 45 v -70 h 30"
       id="path37" />
    <path
       d="m 225,250 h 45 v 10 h 30"
       id="path38" />
    <!-- Reset gate to reset operation -->
    <path
       d="m 480,180 h 16 v 130 h 34"
       id="path39"
       sodipodi:nodetypes="cccc" />
    <!-- Previous hidden state to reset operation -->
    <path
       d="m 130,220 h 20 v 110 h 380"
       id="path40" />
    <!-- Reset operation to candidate computation -->
    <path
       d="m 570,320 h 50 v -10 h 30"
       id="path41" />
    <!-- Current input to candidate -->
    <path
       d="m 130,320 h 30 v 80 h 540 v -60"
       id="path42" />
    <!-- Update gate output paths -->
    <path
       d="m 480,260 h 30 v -45 h 370"
       id="path43" />
    <path
       d="m 510,260 v 12 h 450"
       id="path44"
       sodipodi:nodetypes="ccc" />
    <!-- Candidate to multiplication -->
    <path
       d="M 830,310 H 960"
       id="path45" />
    <!-- Previous hidden to (1-z) multiplication -->
    <path
       d="M 150,220 V 120 h 830 v 100"
       id="path46" />
    <!-- (1-z) to multiplication -->
    <path
       d="m 940,215 h 20 v 15"
       id="path47" />
    <!-- Final computations -->
    <path
       d="m 1000,240 h 60 v 30"
       id="path48" />
    <path
       d="m 1000,320 h 60 v -30"
       id="path49" />
    <!-- Final output -->
    <path
       d="m 1105,280 h 45"
       id="path50" />
  </g>
  <!-- Hidden State Flow (feedback loop) -->
  <g
     stroke="#0891b2"
     stroke-width="3"
     fill="none"
     marker-end="url(#hiddenArrow)"
     opacity="0.8"
     id="g51"
     transform="translate(-49,-84.5)">
    <!-- Feedback from output to input -->
    <path
       d="m 1210.314,260.4411 -0.8486,-2.13832 L 1210,86 H 90 v 108.74926"
       stroke-dasharray="5, 3"
       id="path51"
       sodipodi:nodetypes="ccccc" />
  </g>
  <!-- Information Flow Labels -->
  <g
     id="flow-labels"
     transform="translate(-49,-84.5)">
    <!-- Gate labels -->
    <text
       x="350"
       y="192"
       text-anchor="middle"
       class="text-xs"
       fill="#92400e"
       id="text52"><tspan
         sodipodi:role="line"
         id="tspan84"
         x="350"
         y="192">How much to</tspan><tspan
         sodipodi:role="line"
         id="tspan85"
         x="350"
         y="205.75">reset?</tspan></text>
    <text
       x="350"
       y="270"
       text-anchor="middle"
       class="text-xs"
       fill="#92400e"
       id="text53"><tspan
         sodipodi:role="line"
         id="tspan86"
         x="350"
         y="270">How much to</tspan><tspan
         sodipodi:role="line"
         id="tspan87"
         x="350"
         y="283.75">update?</tspan></text>
    <!-- Operation descriptions -->
    <text
       x="550"
       y="380"
       text-anchor="middle"
       class="text-xs"
       fill="#374151"
       id="text54">Reset previous state</text>
    <text
       x="700"
       y="260"
       text-anchor="middle"
       class="text-xs"
       fill="#16a34a"
       id="text55">Compute new candidate</text>
    <text
       x="879.12854"
       y="181.88545"
       text-anchor="middle"
       class="text-xs"
       fill="#374151"
       id="text56">Interpolate between old and new</text>
  </g>
  <!-- Mathematical Equations Panel -->
  <!-- Legend -->
  <!-- Highlighting Classes -->
  <style
     id="style84">
    .highlight-reset { fill: url(#gateGrad) !important; stroke: #f59e0b !important; stroke-width: 3px !important; }
    .highlight-update { fill: url(#gateGrad) !important; stroke: #f59e0b !important; stroke-width: 3px !important; }
    .highlight-candidate { fill: url(#candidateGrad) !important; stroke: #16a34a !important; stroke-width: 3px !important; }
    .highlight-hidden { fill: url(#hiddenGrad) !important; stroke: #0891b2 !important; stroke-width: 3px !important; }
    .text-xs { font-size: 11px; }
    .text-sm { font-size: 13px; }
    .text-lg { font-size: 16px; }
    .text-xl { font-size: 18px; }
    .font-bold { font-weight: bold; }
    .font-semibold { font-weight: 600; }
    .font-medium { font-weight: 500; }
    .font-mono { font-family: monospace; }
  </style>
  <!-- JavaScript Interface -->
  <script
     id="script84"><![CDATA[
    function highlightGate(gate) {
      // Remove previous highlights
      document.querySelectorAll('[class*="highlight-"]').forEach(el => {
        el.className = el.className.replace(/highlight-\w+/g, '');
      });
      
      // Add highlight to specified gate
      if (gate) {
        const gateElement = document.getElementById(gate + '-gate');
        if (gateElement) {
          gateElement.classList.add('highlight-' + gate);
        }
      }
    }
    
    function highlightComponent(component) {
      // Remove previous highlights
      document.querySelectorAll('[class*="highlight-"]').forEach(el => {
        el.className = el.className.replace(/highlight-\w+/g, '');
      });
      
      // Add highlight to specified component
      if (component) {
        const compElement = document.getElementById(component);
        if (compElement) {
          compElement.classList.add('highlight-' + component.replace('-', ''));
        }
      }
    }
    
    function highlightFlow(flowType) {
      const flows = {
        'hidden': () => {
          document.querySelectorAll('[stroke="#0891b2"]').forEach(el => {
            el.style.opacity = '1';
            el.style.strokeWidth = '4';
          });
        },
        'gates': () => {
          document.querySelectorAll('[marker-end="url(#gateArrow)"]').forEach(el => {
            el.style.opacity = '1';
            el.style.strokeWidth = '3';
          });
        }
      };
      
      if (flows[flowType]) {
        flows[flowType]();
      }
    }
    
    window.gruDiagram = {
      highlightGate,
      highlightComponent,
      highlightFlow,
      clearHighlights: () => {
        document.querySelectorAll('[class*="highlight-"]').forEach(el => {
          el.className = el.className.replace(/highlight-\w+/g, '');
        });
        document.querySelectorAll('[stroke]').forEach(el => {
          el.style.opacity = '';
          el.style.strokeWidth = '';
        });
      }
    };
  ]]></script>
</svg>
